(()=>{var e={};e.id=965,e.ids=[965],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},7017:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>l.a,__next_app__:()=>m,originalPathname:()=>h,pages:()=>c,routeModule:()=>x,tree:()=>d}),s(7904),s(1506),s(5866);var r=s(3191),a=s(8716),i=s(7922),l=s.n(i),n=s(5231),o={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>n[e]);s.d(t,o);let d=["",{children:["admin",{children:["leads",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,7904)),"/Users/feridun/Documents/Projets/locamaster/app/admin/leads/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,1506)),"/Users/feridun/Documents/Projets/locamaster/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],c=["/Users/feridun/Documents/Projets/locamaster/app/admin/leads/page.tsx"],h="/admin/leads/page",m={require:s,loadChunk:()=>Promise.resolve()},x=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/admin/leads/page",pathname:"/admin/leads",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},4303:(e,t,s)=>{Promise.resolve().then(s.bind(s,9613))},1824:()=>{},7372:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,2994,23)),Promise.resolve().then(s.t.bind(s,6114,23)),Promise.resolve().then(s.t.bind(s,9727,23)),Promise.resolve().then(s.t.bind(s,9671,23)),Promise.resolve().then(s.t.bind(s,1868,23)),Promise.resolve().then(s.t.bind(s,4759,23))},9613:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>i});var r=s(326),a=s(7577);function i(){let[e,t]=(0,a.useState)([]),[s,i]=(0,a.useState)(""),[d,h]=(0,a.useState)(""),[m,x]=(0,a.useState)(""),[p,u]=(0,a.useState)(!0),[b,g]=(0,a.useState)(null),[j,w]=(0,a.useState)(null),f=(0,a.useMemo)(()=>{let t=s.trim().toLowerCase(),r=d?new Date(`${d}T00:00:00`).getTime():-1/0,a=m?new Date(`${m}T23:59:59.999`).getTime():1/0;return(e??[]).filter(e=>{if(t&&![e.name,e.school,e.email,e.phone,e.message].filter(Boolean).map(e=>String(e).toLowerCase()).join(" | ").includes(t))return!1;let s=e.created_at?new Date(e.created_at).getTime():0;return s>=r&&s<=a})},[e,s,d,m]);async function v(e){if(e&&window.confirm("Supprimer cette demande ? Cette action est d\xe9finitive."))try{let s=await fetch(`/api/leads/${e}`,{method:"DELETE"}),r=await s.json().catch(()=>({}));if(!s.ok||r?.ok!==!0)throw Error(r?.error||`HTTP ${s.status}`);t(t=>t.filter(t=>t.id!==e)),w(t=>t?.id===e?null:t)}catch(e){alert(`Suppression impossible : ${e?.message||"erreur inconnue"}`)}}function N(){window.location.href="/admin/logout"}return(0,r.jsxs)("main",{className:"min-h-screen px-4 sm:px-6 lg:px-8 py-10 text-white",children:[(0,r.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,r.jsxs)("header",{className:"flex flex-col md:flex-row md:items-end gap-6 justify-between mb-6",children:[(0,r.jsxs)("div",{children:[r.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Leads (Formspree + Fallback)"}),(0,r.jsxs)("p",{className:"text-white/60 text-sm",children:["Si Formspree \xe9choue, les demandes sont sauvegard\xe9es ici (",r.jsx("code",{className:"text-white/80",children:"leads"}),")."]})]}),(0,r.jsxs)("div",{className:"flex flex-col md:flex-row gap-3 md:items-end",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[(0,r.jsxs)("div",{className:"flex flex-col",children:[r.jsx("label",{className:"text-xs text-white/60 mb-1",children:"Recherche"}),r.jsx("input",{value:s,onChange:e=>i(e.target.value),placeholder:"nom, \xe9cole, email, tel, message",className:"px-3 py-2 rounded-lg bg-white/10 border border-white/20 placeholder-white/60 focus:outline-none focus:border-amber-400"})]}),(0,r.jsxs)("div",{className:"flex flex-col",children:[r.jsx("label",{className:"text-xs text-white/60 mb-1",children:"Du"}),r.jsx("input",{type:"date",value:d,onChange:e=>h(e.target.value),className:"px-3 py-2 rounded-lg bg-white/10 border border-white/20 focus:outline-none focus:border-amber-400"})]}),(0,r.jsxs)("div",{className:"flex flex-col",children:[r.jsx("label",{className:"text-xs text-white/60 mb-1",children:"Au"}),r.jsx("input",{type:"date",value:m,onChange:e=>x(e.target.value),className:"px-3 py-2 rounded-lg bg-white/10 border border-white/20 focus:outline-none focus:border-amber-400"})]})]}),(0,r.jsxs)("div",{className:"flex gap-3",children:[r.jsx("button",{onClick:()=>{i(""),h(""),x("")},className:"px-4 py-2 rounded-lg bg-white/10 border border-white/20 hover:bg-white/15",children:"R\xe9initialiser"}),r.jsx("button",{onClick:function(){let e=new Blob([[["created_at","name","school","email","phone","message"],...f.map(e=>[e.created_at??"",e.name??"",e.school??"",e.email??"",e.phone??"",(e.message??"").replace(/\n/g," ")])].map(e=>e.map(e=>`"${String(e).replace(/"/g,'""')}"`).join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),t=URL.createObjectURL(e),s=document.createElement("a"),r=new Date().toISOString().slice(0,19).replace(/[:T]/g,"-");s.href=t,s.download=`leads-${r}.csv`,document.body.appendChild(s),s.click(),s.remove(),URL.revokeObjectURL(t)},className:"px-4 py-2 rounded-lg bg-black/80 border border-white/20 hover:bg-black/70",children:"Export CSV"}),r.jsx("button",{onClick:N,className:"px-4 py-2 rounded-lg bg-white/10 border border-white/20 hover:bg-white/15",title:"D\xe9connexion",children:"D\xe9connexion"})]})]})]}),r.jsx("section",{className:"overflow-hidden rounded-2xl border border-white/10",children:r.jsx("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full text-sm",children:[r.jsx("thead",{className:"bg-white/5",children:(0,r.jsxs)("tr",{className:"text-left",children:[r.jsx(l,{children:"Date"}),r.jsx(l,{children:"Nom"}),r.jsx(l,{children:"\xc9tablissement"}),r.jsx(l,{children:"Email"}),r.jsx(l,{children:"T\xe9l\xe9phone"}),r.jsx(l,{children:"Message"}),r.jsx(l,{className:"text-right",children:"Actions"})]})}),(0,r.jsxs)("tbody",{children:[p&&r.jsx("tr",{children:r.jsx("td",{colSpan:7,className:"p-6 text-center text-white/70",children:"Chargement…"})}),b&&!p&&r.jsx("tr",{children:(0,r.jsxs)("td",{colSpan:7,className:"p-6 text-center text-red-300",children:["Erreur : ",b]})}),!p&&!b&&0===f.length&&r.jsx("tr",{children:r.jsx("td",{colSpan:7,className:"p-6 text-center text-white/70",children:"Aucun lead"})}),f.map(e=>(0,r.jsxs)("tr",{className:"border-t border-white/10 hover:bg-white/[.04]",children:[r.jsx(n,{className:"whitespace-nowrap",onClick:()=>w(e),children:o(e.created_at)}),r.jsx(n,{onClick:()=>w(e),children:e.name}),r.jsx(n,{onClick:()=>w(e),children:e.school}),r.jsx(n,{onClick:()=>w(e),children:e.email?r.jsx("a",{href:`mailto:${e.email}`,className:"underline hover:text-white",onClick:e=>e.stopPropagation(),children:e.email}):"-"}),r.jsx(n,{onClick:()=>w(e),children:e.phone?r.jsx("a",{href:`tel:${e.phone}`,className:"hover:text-white",onClick:e=>e.stopPropagation(),children:e.phone}):"-"}),r.jsx(n,{className:"max-w-[420px]",children:r.jsx("div",{className:"truncate text-white/90",onClick:()=>w(e),children:e.message})}),(0,r.jsxs)(n,{className:"text-right",children:[r.jsx("button",{onClick:()=>w(e),className:"px-3 py-1.5 rounded-md bg-white/10 border border-white/20 hover:bg-white/15 text-xs mr-2",children:"Voir"}),r.jsx("button",{onClick:()=>v(e.id),className:"px-3 py-1.5 rounded-md bg-red-600 hover:bg-red-500 text-white text-xs",children:"Supprimer"})]})]},e.id))]})]})})})]}),j&&r.jsx(c,{lead:j,onClose:()=>w(null),onDelete:()=>v(j.id),onLogout:N})]})}function l({children:e,className:t=""}){return r.jsx("th",{className:`px-4 py-3 font-semibold text-white/80 ${t}`,children:e})}function n({children:e,className:t="",onClick:s}){return r.jsx("td",{className:`px-4 py-3 align-top ${s?"cursor-pointer":""} ${t}`,onClick:s,children:e})}function o(e){try{if(!e)return"—";return new Date(e).toLocaleString("fr-FR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return e||"—"}}function d({label:e,children:t}){return(0,r.jsxs)("div",{className:"grid grid-cols-[120px_1fr] gap-3 items-start",children:[r.jsx("div",{className:"text-white/60",children:e}),r.jsx("div",{className:"text-white break-words",children:t})]})}function c({lead:e,onClose:t,onDelete:s,onLogout:i}){let[l,n]=(0,a.useState)("");async function c(e,t="Copi\xe9 !"){try{await navigator.clipboard.writeText(e),n(t),setTimeout(()=>n(""),1200)}catch{n("Impossible de copier"),setTimeout(()=>n(""),1500)}}return(0,r.jsxs)(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-40",onClick:t}),(0,r.jsxs)("aside",{className:"fixed right-0 top-0 h-full w-full sm:w-[560px] bg-[#0d0d0d] border-l border-white/10 z-50 shadow-2xl flex flex-col",role:"dialog","aria-modal":"true",children:[(0,r.jsxs)("header",{className:"p-4 border-b border-white/10",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[r.jsx("h2",{className:"text-lg font-semibold",children:"D\xe9tail du lead"}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-2",children:[r.jsx("a",{href:function(e){let t=e.email||"",s=`Demande d'informations – ${e.school||"\xc9tablissement"} – ${e.name||""}`.trim(),r=["Bonjour,","","Je vous contacte suite \xe0 votre demande d’informations sur LOCAMASTER.","","R\xe9capitulatif de votre demande :",`• Nom : ${e.name||"—"}`,`• \xc9tablissement : ${e.school||"—"}`,`• Email : ${e.email||"—"}`,`• T\xe9l\xe9phone : ${e.phone||"—"}`,"",e.message?`Message :
${e.message}`:"","","—","LOCAMASTER"].filter(Boolean);return`mailto:${encodeURIComponent(t)}?subject=${encodeURIComponent(s)}&body=${encodeURIComponent(r.join("\n"))}`}(e),className:"px-3 py-1.5 rounded-lg bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 hover:bg-emerald-500/25",children:"Contacter"}),r.jsx("button",{onClick:()=>e.email&&c(e.email,"Email copi\xe9"),className:"px-3 py-1.5 rounded-lg bg-white/10 border border-white/20 hover:bg-white/15 disabled:opacity-40",disabled:!e.email,children:"Copier email"}),r.jsx("button",{onClick:()=>e.phone&&c(e.phone,"T\xe9l\xe9phone copi\xe9"),className:"px-3 py-1.5 rounded-lg bg-white/10 border border-white/20 hover:bg-white/15 disabled:opacity-40",disabled:!e.phone,children:"Copier t\xe9l\xe9phone"}),r.jsx("button",{onClick:()=>c(`Date: ${o(e.created_at)}
Nom: ${e.name||"—"}
\xc9tablissement: ${e.school||"—"}
Email: ${e.email||"—"}
T\xe9l\xe9phone: ${e.phone||"—"}
Message: ${e.message||"—"}`,"Lead copi\xe9"),className:"px-3 py-1.5 rounded-lg bg-white/10 border border-white/20 hover:bg-white/15",children:"Copier tout"}),r.jsx("button",{onClick:s,className:"px-3 py-1.5 rounded-lg bg-red-600 hover:bg-red-500 text-white",children:"Supprimer"}),r.jsx("button",{onClick:i,className:"px-3 py-1.5 rounded-lg bg-white/10 border border-white/20 hover:bg-white/15",title:"D\xe9connexion",children:"D\xe9connexion"}),r.jsx("button",{onClick:t,className:"px-3 py-1.5 rounded-lg bg-white/10 border border-white/20 hover:bg-white/15",children:"Fermer"})]})]}),l&&r.jsx("div",{className:"mt-3 text-sm text-emerald-300",children:l})]}),(0,r.jsxs)("div",{className:"p-4 space-y-4 text-sm overflow-auto",children:[r.jsx(d,{label:"Date",children:o(e.created_at)}),r.jsx(d,{label:"Nom",children:e.name||"—"}),r.jsx(d,{label:"\xc9tablissement",children:e.school||"—"}),r.jsx(d,{label:"Email",children:e.email?r.jsx("a",{href:`mailto:${e.email}`,className:"underline hover:text-white",children:e.email}):"—"}),r.jsx(d,{label:"T\xe9l\xe9phone",children:e.phone?r.jsx("a",{href:`tel:${e.phone}`,className:"hover:text-white",children:e.phone}):"—"}),r.jsx(d,{label:"Message",children:r.jsx("div",{className:"whitespace-pre-wrap text-white/90",children:e.message||"—"})})]})]})]})}},7904:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(8570).createProxy)(String.raw`/Users/feridun/Documents/Projets/locamaster/app/admin/leads/page.tsx#default`)},1506:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});var r=s(9510);function a({children:e}){return r.jsx("html",{lang:"fr",className:"h-full bg-[#0b0b0b]",children:(0,r.jsxs)("body",{className:"min-h-screen h-full bg-[#0b0b0b] text-white antialiased",children:[r.jsx("div",{className:"site-bg site-bg-breath","aria-hidden":"true"}),r.jsx("div",{className:"relative z-10",children:e})]})})}s(7272)},7272:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[276,471],()=>s(7017));module.exports=r})();
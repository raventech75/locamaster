"use strict";(()=>{var e={};e.id=641,e.ids=[641],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2615:e=>{e.exports=require("http")},8791:e=>{e.exports=require("https")},8621:e=>{e.exports=require("punycode")},6162:e=>{e.exports=require("stream")},7360:e=>{e.exports=require("url")},1568:e=>{e.exports=require("zlib")},8149:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>S,patchFetch:()=>v,requestAsyncStorage:()=>l,routeModule:()=>m,serverHooks:()=>g,staticGenerationAsyncStorage:()=>h});var a={};r.r(a),r.d(a,{GET:()=>p,dynamic:()=>c,runtime:()=>i});var o=r(9303),s=r(8716),n=r(670),d=r(7070),u=r(9498);let i="nodejs",c="force-dynamic";async function p(e){try{let t=new URL(e.url),r=Math.min(365,Math.max(7,parseInt(t.searchParams.get("days")||"30",10))),a=(function(e){let t=new Date;return t.setDate(t.getDate()-e),t})(r).toISOString(),o=new Date().toISOString(),s="https://mjmbumsuszxcrolfrddh.supabase.co",n=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!s||!n)return d.NextResponse.json({ok:!0,note:"Supabase non configur\xe9: donn\xe9es de d\xe9monstration",range:{from:a,to:o},totals:{gross:28450,ordersCount:392,avgCart:73,schoolShare:Math.round(7112.5),locamasterShare:Math.round(21337.5),growth:8.4},recentOrders:[{id:"ord_1",created_at:new Date().toISOString(),customer:"M. Dupont",amount:129,status:"paid"},{id:"ord_2",created_at:new Date().toISOString(),customer:"Mme Bernard",amount:59,status:"pending"}],nextPayouts:[{id:"p_1",date:new Date(Date.now()+3*864e5).toISOString(),school:"Coll\xe8ge Jean Moulin",amount:1450,status:"scheduled"}]});let i=(0,u.eI)(s,n),{data:c,error:p}=await i.from("orders").select("id, created_at, amount, status, customer").gte("created_at",a).lte("created_at",o).order("created_at",{ascending:!1}).limit(50);if(p&&/does not exist/i.test(p.message))return d.NextResponse.json({ok:!0,note:"Tables non trouv\xe9es: donn\xe9es de d\xe9monstration",range:{from:a,to:o},totals:{gross:28450,ordersCount:392,avgCart:73,schoolShare:Math.round(7112.5),locamasterShare:Math.round(21337.5),growth:8.4},recentOrders:[{id:"ord_1",created_at:new Date().toISOString(),customer:"M. Dupont",amount:129,status:"paid"},{id:"ord_2",created_at:new Date().toISOString(),customer:"Mme Bernard",amount:59,status:"pending"}],nextPayouts:[{id:"p_1",date:new Date(Date.now()+3*864e5).toISOString(),school:"Coll\xe8ge Jean Moulin",amount:1450,status:"scheduled"}]});if(p)throw p;let m=(c||[]).reduce((e,t)=>e+Number(t.amount||0),0),l=c?.length??0,h=[],{data:g}=await i.from("payouts").select("id, date, school, amount, status").gte("date",new Date().toISOString()).order("date",{ascending:!0}).limit(10);return g&&(h=g),d.NextResponse.json({ok:!0,range:{from:a,to:o},totals:{gross:m,ordersCount:l,avgCart:l?Math.round(m/l):0,schoolShare:Math.round(.25*m),locamasterShare:Math.round(.75*m),growth:0},recentOrders:(c||[]).slice(0,10).map(e=>({id:e.id,created_at:e.created_at,customer:e.customer,amount:Number(e.amount||0),status:e.status||"paid"})),nextPayouts:h})}catch(e){return console.error("[/api/dashboard/overview] error:",e),d.NextResponse.json({ok:!1,error:"Server error"},{status:500})}}let m=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/dashboard/overview/route",pathname:"/api/dashboard/overview",filename:"route",bundlePath:"app/api/dashboard/overview/route"},resolvedPagePath:"/Users/feridun/Documents/Projets/locamaster/app/api/dashboard/overview/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:l,staticGenerationAsyncStorage:h,serverHooks:g}=m,S="/api/dashboard/overview/route";function v(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:h})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,972,498],()=>r(8149));module.exports=a})();
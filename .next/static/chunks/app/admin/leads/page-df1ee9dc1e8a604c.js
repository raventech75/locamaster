(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[965],{5084:function(e,t,l){Promise.resolve().then(l.bind(l,5261))},5261:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return r}});var n=l(7437),a=l(2265);function r(){let[e,t]=(0,a.useState)([]),[l,r]=(0,a.useState)(""),[c,h]=(0,a.useState)(""),[m,x]=(0,a.useState)(""),[u,p]=(0,a.useState)(!0),[b,g]=(0,a.useState)(null),[w,j]=(0,a.useState)(null);(0,a.useEffect)(()=>{(async()=>{p(!0),g(null);try{let e;let l=await fetch("/api/leads",{cache:"no-store"}),n=l.clone();try{e=await l.json()}catch(t){let e=await n.text();throw Error("R\xe9ponse non-JSON (".concat(l.status,") : ").concat((null==e?void 0:e.slice(0,180))||"vide"))}if(!l.ok)throw Error((null==e?void 0:e.error)||"HTTP ".concat(l.status));t(Array.isArray(null==e?void 0:e.leads)?e.leads:[])}catch(e){g(e.message||"Erreur inconnue"),t([])}finally{p(!1)}})()},[]);let f=(0,a.useMemo)(()=>{let t=l.trim().toLowerCase(),n=c?new Date("".concat(c,"T00:00:00")).getTime():-1/0,a=m?new Date("".concat(m,"T23:59:59.999")).getTime():1/0;return(null!=e?e:[]).filter(e=>{if(t&&![e.name,e.school,e.email,e.phone,e.message].filter(Boolean).map(e=>String(e).toLowerCase()).join(" | ").includes(t))return!1;let l=e.created_at?new Date(e.created_at).getTime():0;return l>=n&&l<=a})},[e,l,c,m]);async function v(e){if(e&&window.confirm("Supprimer cette demande ? Cette action est d\xe9finitive."))try{let l=await fetch("/api/leads/".concat(e),{method:"DELETE"}),n=await l.json().catch(()=>({}));if(!l.ok||(null==n?void 0:n.ok)!==!0)throw Error((null==n?void 0:n.error)||"HTTP ".concat(l.status));t(t=>t.filter(t=>t.id!==e)),j(t=>(null==t?void 0:t.id)===e?null:t)}catch(e){alert("Suppression impossible : ".concat((null==e?void 0:e.message)||"erreur inconnue"))}}function N(){window.location.href="/admin/logout"}return(0,n.jsxs)("main",{className:"min-h-screen px-4 sm:px-6 lg:px-8 py-10 text-white",children:[(0,n.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,n.jsxs)("header",{className:"flex flex-col md:flex-row md:items-end gap-6 justify-between mb-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-2xl md:text-3xl font-bold",children:"Leads (Formspree + Fallback)"}),(0,n.jsxs)("p",{className:"text-white/60 text-sm",children:["Si Formspree \xe9choue, les demandes sont sauvegard\xe9es ici (",(0,n.jsx)("code",{className:"text-white/80",children:"leads"}),")."]})]}),(0,n.jsxs)("div",{className:"flex flex-col md:flex-row gap-3 md:items-end",children:[(0,n.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsx)("label",{className:"text-xs text-white/60 mb-1",children:"Recherche"}),(0,n.jsx)("input",{value:l,onChange:e=>r(e.target.value),placeholder:"nom, \xe9cole, email, tel, message",className:"px-3 py-2 rounded-lg bg-white/10 border border-white/20 placeholder-white/60 focus:outline-none focus:border-amber-400"})]}),(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsx)("label",{className:"text-xs text-white/60 mb-1",children:"Du"}),(0,n.jsx)("input",{type:"date",value:c,onChange:e=>h(e.target.value),className:"px-3 py-2 rounded-lg bg-white/10 border border-white/20 focus:outline-none focus:border-amber-400"})]}),(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsx)("label",{className:"text-xs text-white/60 mb-1",children:"Au"}),(0,n.jsx)("input",{type:"date",value:m,onChange:e=>x(e.target.value),className:"px-3 py-2 rounded-lg bg-white/10 border border-white/20 focus:outline-none focus:border-amber-400"})]})]}),(0,n.jsxs)("div",{className:"flex gap-3",children:[(0,n.jsx)("button",{onClick:()=>{r(""),h(""),x("")},className:"px-4 py-2 rounded-lg bg-white/10 border border-white/20 hover:bg-white/15",children:"R\xe9initialiser"}),(0,n.jsx)("button",{onClick:function(){let e=new Blob([[["created_at","name","school","email","phone","message"],...f.map(e=>{var t,l,n,a,r,s;return[null!==(t=e.created_at)&&void 0!==t?t:"",null!==(l=e.name)&&void 0!==l?l:"",null!==(n=e.school)&&void 0!==n?n:"",null!==(a=e.email)&&void 0!==a?a:"",null!==(r=e.phone)&&void 0!==r?r:"",(null!==(s=e.message)&&void 0!==s?s:"").replace(/\n/g," ")]})].map(e=>e.map(e=>'"'.concat(String(e).replace(/"/g,'""'),'"')).join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),t=URL.createObjectURL(e),l=document.createElement("a"),n=new Date().toISOString().slice(0,19).replace(/[:T]/g,"-");l.href=t,l.download="leads-".concat(n,".csv"),document.body.appendChild(l),l.click(),l.remove(),URL.revokeObjectURL(t)},className:"px-4 py-2 rounded-lg bg-black/80 border border-white/20 hover:bg-black/70",children:"Export CSV"}),(0,n.jsx)("button",{onClick:N,className:"px-4 py-2 rounded-lg bg-white/10 border border-white/20 hover:bg-white/15",title:"D\xe9connexion",children:"D\xe9connexion"})]})]})]}),(0,n.jsx)("section",{className:"overflow-hidden rounded-2xl border border-white/10",children:(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"min-w-full text-sm",children:[(0,n.jsx)("thead",{className:"bg-white/5",children:(0,n.jsxs)("tr",{className:"text-left",children:[(0,n.jsx)(s,{children:"Date"}),(0,n.jsx)(s,{children:"Nom"}),(0,n.jsx)(s,{children:"\xc9tablissement"}),(0,n.jsx)(s,{children:"Email"}),(0,n.jsx)(s,{children:"T\xe9l\xe9phone"}),(0,n.jsx)(s,{children:"Message"}),(0,n.jsx)(s,{className:"text-right",children:"Actions"})]})}),(0,n.jsxs)("tbody",{children:[u&&(0,n.jsx)("tr",{children:(0,n.jsx)("td",{colSpan:7,className:"p-6 text-center text-white/70",children:"Chargement…"})}),b&&!u&&(0,n.jsx)("tr",{children:(0,n.jsxs)("td",{colSpan:7,className:"p-6 text-center text-red-300",children:["Erreur : ",b]})}),!u&&!b&&0===f.length&&(0,n.jsx)("tr",{children:(0,n.jsx)("td",{colSpan:7,className:"p-6 text-center text-white/70",children:"Aucun lead"})}),f.map(e=>(0,n.jsxs)("tr",{className:"border-t border-white/10 hover:bg-white/[.04]",children:[(0,n.jsx)(i,{className:"whitespace-nowrap",onClick:()=>j(e),children:o(e.created_at)}),(0,n.jsx)(i,{onClick:()=>j(e),children:e.name}),(0,n.jsx)(i,{onClick:()=>j(e),children:e.school}),(0,n.jsx)(i,{onClick:()=>j(e),children:e.email?(0,n.jsx)("a",{href:"mailto:".concat(e.email),className:"underline hover:text-white",onClick:e=>e.stopPropagation(),children:e.email}):"-"}),(0,n.jsx)(i,{onClick:()=>j(e),children:e.phone?(0,n.jsx)("a",{href:"tel:".concat(e.phone),className:"hover:text-white",onClick:e=>e.stopPropagation(),children:e.phone}):"-"}),(0,n.jsx)(i,{className:"max-w-[420px]",children:(0,n.jsx)("div",{className:"truncate text-white/90",onClick:()=>j(e),children:e.message})}),(0,n.jsxs)(i,{className:"text-right",children:[(0,n.jsx)("button",{onClick:()=>j(e),className:"px-3 py-1.5 rounded-md bg-white/10 border border-white/20 hover:bg-white/15 text-xs mr-2",children:"Voir"}),(0,n.jsx)("button",{onClick:()=>v(e.id),className:"px-3 py-1.5 rounded-md bg-red-600 hover:bg-red-500 text-white text-xs",children:"Supprimer"})]})]},e.id))]})]})})})]}),w&&(0,n.jsx)(d,{lead:w,onClose:()=>j(null),onDelete:()=>v(w.id),onLogout:N})]})}function s(e){let{children:t,className:l=""}=e;return(0,n.jsx)("th",{className:"px-4 py-3 font-semibold text-white/80 ".concat(l),children:t})}function i(e){let{children:t,className:l="",onClick:a}=e;return(0,n.jsx)("td",{className:"px-4 py-3 align-top ".concat(a?"cursor-pointer":""," ").concat(l),onClick:a,children:t})}function o(e){try{if(!e)return"—";return new Date(e).toLocaleString("fr-FR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch(t){return e||"—"}}function c(e){let{label:t,children:l}=e;return(0,n.jsxs)("div",{className:"grid grid-cols-[120px_1fr] gap-3 items-start",children:[(0,n.jsx)("div",{className:"text-white/60",children:t}),(0,n.jsx)("div",{className:"text-white break-words",children:l})]})}function d(e){let{lead:t,onClose:l,onDelete:r,onLogout:s}=e,[i,d]=(0,a.useState)("");async function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Copi\xe9 !";try{await navigator.clipboard.writeText(e),d(t),setTimeout(()=>d(""),1200)}catch(e){d("Impossible de copier"),setTimeout(()=>d(""),1500)}}return(0,a.useEffect)(()=>{function e(e){"Escape"===e.key&&l()}return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[l]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-40",onClick:l}),(0,n.jsxs)("aside",{className:"fixed right-0 top-0 h-full w-full sm:w-[560px] bg-[#0d0d0d] border-l border-white/10 z-50 shadow-2xl flex flex-col",role:"dialog","aria-modal":"true",children:[(0,n.jsxs)("header",{className:"p-4 border-b border-white/10",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold",children:"D\xe9tail du lead"}),(0,n.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,n.jsx)("a",{href:function(e){let t=e.email||"",l="Demande d'informations – ".concat(e.school||"\xc9tablissement"," – ").concat(e.name||"").trim(),n=["Bonjour,","","Je vous contacte suite \xe0 votre demande d’informations sur LOCAMASTER.","","R\xe9capitulatif de votre demande :","• Nom : ".concat(e.name||"—"),"• \xc9tablissement : ".concat(e.school||"—"),"• Email : ".concat(e.email||"—"),"• T\xe9l\xe9phone : ".concat(e.phone||"—"),"",e.message?"Message :\n".concat(e.message):"","","—","LOCAMASTER"].filter(Boolean);return"mailto:".concat(encodeURIComponent(t),"?subject=").concat(encodeURIComponent(l),"&body=").concat(encodeURIComponent(n.join("\n")))}(t),className:"px-3 py-1.5 rounded-lg bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 hover:bg-emerald-500/25",children:"Contacter"}),(0,n.jsx)("button",{onClick:()=>t.email&&h(t.email,"Email copi\xe9"),className:"px-3 py-1.5 rounded-lg bg-white/10 border border-white/20 hover:bg-white/15 disabled:opacity-40",disabled:!t.email,children:"Copier email"}),(0,n.jsx)("button",{onClick:()=>t.phone&&h(t.phone,"T\xe9l\xe9phone copi\xe9"),className:"px-3 py-1.5 rounded-lg bg-white/10 border border-white/20 hover:bg-white/15 disabled:opacity-40",disabled:!t.phone,children:"Copier t\xe9l\xe9phone"}),(0,n.jsx)("button",{onClick:()=>h(["Date: ".concat(o(t.created_at)),"Nom: ".concat(t.name||"—"),"\xc9tablissement: ".concat(t.school||"—"),"Email: ".concat(t.email||"—"),"T\xe9l\xe9phone: ".concat(t.phone||"—"),"Message: ".concat(t.message||"—")].join("\n"),"Lead copi\xe9"),className:"px-3 py-1.5 rounded-lg bg-white/10 border border-white/20 hover:bg-white/15",children:"Copier tout"}),(0,n.jsx)("button",{onClick:r,className:"px-3 py-1.5 rounded-lg bg-red-600 hover:bg-red-500 text-white",children:"Supprimer"}),(0,n.jsx)("button",{onClick:s,className:"px-3 py-1.5 rounded-lg bg-white/10 border border-white/20 hover:bg-white/15",title:"D\xe9connexion",children:"D\xe9connexion"}),(0,n.jsx)("button",{onClick:l,className:"px-3 py-1.5 rounded-lg bg-white/10 border border-white/20 hover:bg-white/15",children:"Fermer"})]})]}),i&&(0,n.jsx)("div",{className:"mt-3 text-sm text-emerald-300",children:i})]}),(0,n.jsxs)("div",{className:"p-4 space-y-4 text-sm overflow-auto",children:[(0,n.jsx)(c,{label:"Date",children:o(t.created_at)}),(0,n.jsx)(c,{label:"Nom",children:t.name||"—"}),(0,n.jsx)(c,{label:"\xc9tablissement",children:t.school||"—"}),(0,n.jsx)(c,{label:"Email",children:t.email?(0,n.jsx)("a",{href:"mailto:".concat(t.email),className:"underline hover:text-white",children:t.email}):"—"}),(0,n.jsx)(c,{label:"T\xe9l\xe9phone",children:t.phone?(0,n.jsx)("a",{href:"tel:".concat(t.phone),className:"hover:text-white",children:t.phone}):"—"}),(0,n.jsx)(c,{label:"Message",children:(0,n.jsx)("div",{className:"whitespace-pre-wrap text-white/90",children:t.message||"—"})})]})]})]})}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=5084)}),_N_E=e.O()}]);
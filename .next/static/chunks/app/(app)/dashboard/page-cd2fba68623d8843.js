(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[40],{166:function(e,t,s){Promise.resolve().then(s.bind(s,9182))},9182:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return o}});var r=s(7437),l=s(2265);function n(e){let{className:t}=e;return(0,r.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",className:t,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[(0,r.jsx)("polyline",{points:"23 4 23 10 17 10"}),(0,r.jsx)("polyline",{points:"1 20 1 14 7 14"}),(0,r.jsx)("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10"}),(0,r.jsx)("path",{d:"M20.49 15a9 9 0 0 1-14.85 3.36L1 14"})]})}function i(e){let{className:t}=e;return(0,r.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",className:t,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[(0,r.jsx)("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),(0,r.jsx)("polyline",{points:"7 10 12 15 17 10"}),(0,r.jsx)("line",{x1:"12",x2:"12",y1:"15",y2:"3"})]})}function a(e){let{className:t}=e;return(0,r.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",className:t,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[(0,r.jsx)("line",{x1:"7",y1:"17",x2:"17",y2:"7"}),(0,r.jsx)("polyline",{points:"7 7 17 7 17 17"})]})}function d(e){let{className:t}=e;return(0,r.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",className:t,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[(0,r.jsx)("line",{x1:"7",y1:"7",x2:"17",y2:"17"}),(0,r.jsx)("polyline",{points:"17 7 7 7 7 17"})]})}function o(){var e,t,s,a,d;let[o,f]=(0,l.useState)(30),[g,w]=(0,l.useState)(!1),[N,y]=(0,l.useState)(null),[k,C]=(0,l.useState)(null);async function S(){w(!0),C(null);try{let e=await fetch("/api/dashboard/overview?days=".concat(o),{cache:"no-store"}),t=await e.json();if(!e.ok||(null==t?void 0:t.ok)===!1)throw Error((null==t?void 0:t.error)||"HTTP ".concat(e.status));y(t)}catch(e){C((null==e?void 0:e.message)||"Erreur r\xe9seau")}finally{w(!1)}}(0,l.useEffect)(()=>{S()},[o]);let L=null==N?void 0:N.totals,D=null!==(t=null==L?void 0:L.growth)&&void 0!==t?t:0;return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex flex-col md:flex-row md:items-end md:justify-between gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl md:text-3xl font-extrabold tracking-tight",children:"Aper\xe7u"}),(0,r.jsxs)("p",{className:"text-white/70 text-sm",children:["Vue synth\xe9tique des ",o," derniers jours."]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(c,{days:o,setDays:f,v:7}),(0,r.jsx)(c,{days:o,setDays:f,v:30}),(0,r.jsx)(c,{days:o,setDays:f,v:90}),(0,r.jsxs)("button",{onClick:S,className:"inline-flex items-center gap-2 rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm hover:bg-white/10",children:[(0,r.jsx)(n,{className:"h-4 w-4"})," Actualiser"]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,r.jsx)(x,{label:"Chiffre d’affaires",value:p(null==L?void 0:L.gross),delta:D}),(0,r.jsx)(x,{label:"Commandes",value:null!==(s=null==L?void 0:null===(e=L.ordersCount)||void 0===e?void 0:e.toLocaleString("fr-FR"))&&void 0!==s?s:"—"}),(0,r.jsx)(x,{label:"Panier moyen",value:p(null==L?void 0:L.avgCart)}),(0,r.jsx)(x,{label:"Part \xe9tablissement (25%)",value:p(null==L?void 0:L.schoolShare),accent:"emerald"})]}),(0,r.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,r.jsx)(u,{title:"\xc9volution du CA",children:(0,r.jsx)(h,{note:"Brancher plus tard: s\xe9ries quotidiennes Supabase/Stripe"})}),(0,r.jsx)(u,{title:"R\xe9partition des revenus",children:(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsx)(m,{label:"LOCAMASTER (75%)",value:p(null==L?void 0:L.locamasterShare)}),(0,r.jsx)(m,{label:"\xc9tablissements (25%)",value:p(null==L?void 0:L.schoolShare)}),(0,r.jsx)("div",{className:"col-span-2 text-white/60 text-xs",children:"Bas\xe9 sur la p\xe9riode s\xe9lectionn\xe9e."})]})})]}),(0,r.jsxs)("div",{className:"grid lg:grid-cols-2 gap-4",children:[(0,r.jsx)(j,{title:"Derni\xe8res commandes",actions:(0,r.jsx)("a",{href:"/dashboard/orders",className:"text-sm text-white/80 underline",children:"Voir tout"}),columns:["Date","Client","Montant","Statut"],rows:(null!==(a=null==N?void 0:N.recentOrders)&&void 0!==a?a:[]).map(e=>{var t;return[new Date(e.created_at).toLocaleString("fr-FR"),null!==(t=e.customer)&&void 0!==t?t:"—",p(e.amount),(0,r.jsx)(b,{status:e.status},e.id)]}),empty:"Aucune commande r\xe9cente."}),(0,r.jsx)(j,{title:"Prochains versements",actions:(0,r.jsx)("a",{href:"/dashboard/commissions",className:"text-sm text-white/80 underline",children:"D\xe9tails"}),columns:["Date","\xc9tablissement","Montant","Statut"],rows:(null!==(d=null==N?void 0:N.nextPayouts)&&void 0!==d?d:[]).map(e=>[new Date(e.date).toLocaleDateString("fr-FR"),e.school,p(e.amount),(0,r.jsx)(v,{status:e.status},e.id)]),empty:"Aucun versement planifi\xe9."})]}),(0,r.jsx)("div",{className:"flex items-center justify-end",children:(0,r.jsxs)("a",{href:"/api/dashboard/export?days=".concat(o),className:"inline-flex items-center gap-2 rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm hover:bg-white/10",children:[(0,r.jsx)(i,{className:"h-4 w-4"})," Export CSV (p\xe9riode)"]})}),g&&(0,r.jsx)("div",{className:"text-white/70 text-sm",children:"Chargement…"}),k&&(0,r.jsxs)("div",{className:"text-red-400 text-sm",children:["Erreur : ",k]}),(null==N?void 0:N.note)&&(0,r.jsx)("div",{className:"text-white/60 text-xs",children:N.note})]})}function c(e){let{days:t,setDays:s,v:l}=e,n=t===l;return(0,r.jsxs)("button",{onClick:()=>s(l),className:"rounded-lg px-3 py-2 text-sm border ".concat(n?"border-white/30 bg-white/10":"border-white/15 bg-white/5 hover:bg-white/10"),children:[l," j"]})}function x(e){let{label:t,value:s,delta:l,accent:n}=e,i=(null!=l?l:0)>=0;return(0,r.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-white/[.04] p-4",children:[(0,r.jsx)("div",{className:"text-white/70 text-xs uppercase",children:t}),(0,r.jsx)("div",{className:"mt-1 text-2xl font-extrabold tabular-nums",children:s}),"number"==typeof l&&(0,r.jsxs)("div",{className:"mt-1 inline-flex items-center gap-1 text-xs ".concat(i?"text-emerald-400":"text-red-400"),children:[i?(0,r.jsx)(a,{className:"h-3.5 w-3.5"}):(0,r.jsx)(d,{className:"h-3.5 w-3.5"}),i?"+":"",l.toFixed(1),"%"]}),"emerald"===n&&(0,r.jsx)("div",{className:"mt-3 h-1.5 w-full rounded bg-emerald-500/30",children:(0,r.jsx)("div",{className:"h-1.5 w-2/3 rounded bg-emerald-400"})})]})}function u(e){let{title:t,children:s}=e;return(0,r.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-white/[.04] p-4",children:[(0,r.jsx)("div",{className:"flex items-center justify-between",children:(0,r.jsx)("div",{className:"font-semibold",children:t})}),(0,r.jsx)("div",{className:"mt-3 h-[240px] rounded-xl border border-white/10 bg-black/20 grid place-items-center",children:s})]})}function h(e){let{note:t}=e;return(0,r.jsxs)("div",{className:"text-center text-white/60 text-xs",children:[(0,r.jsx)("div",{className:"mb-2",children:"\uD83D\uDCC8 Graphique \xe0 brancher"}),t&&(0,r.jsx)("div",{children:t})]})}function m(e){let{label:t,value:s}=e;return(0,r.jsxs)("div",{className:"rounded-xl border border-white/10 bg-white/[.04] p-3",children:[(0,r.jsx)("div",{className:"text-xs text-white/70",children:t}),(0,r.jsx)("div",{className:"text-lg font-bold tabular-nums",children:s})]})}function j(e){let{title:t,actions:s,columns:l,rows:n,empty:i}=e;return(0,r.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-white/[.04] p-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsx)("div",{className:"font-semibold",children:t}),s]}),(0,r.jsx)("div",{className:"overflow-auto",children:(0,r.jsxs)("table",{className:"w-full text-sm",children:[(0,r.jsx)("thead",{children:(0,r.jsx)("tr",{className:"text-left text-white/60",children:l.map(e=>(0,r.jsx)("th",{className:"py-2 pr-3 font-medium",children:e},e))})}),(0,r.jsx)("tbody",{children:0===n.length?(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:l.length,className:"py-6 text-white/60",children:i})}):n.map((e,t)=>(0,r.jsx)("tr",{className:"border-t border-white/10",children:e.map((e,t)=>(0,r.jsx)("td",{className:"py-2 pr-3",children:e},t))},t))})]})})]})}function b(e){let{status:t}=e;return(0,r.jsx)("span",{className:"inline-flex items-center rounded-full border px-2 py-0.5 text-xs ".concat({paid:"bg-emerald-500/20 text-emerald-300 border-emerald-400/30",pending:"bg-amber-500/20 text-amber-300 border-amber-400/30",refunded:"bg-blue-500/20 text-blue-300 border-blue-400/30",failed:"bg-red-500/20 text-red-300 border-red-400/30"}[t]),children:t})}function v(e){let{status:t}=e;return(0,r.jsx)("span",{className:"inline-flex items-center rounded-full border px-2 py-0.5 text-xs ".concat({scheduled:"bg-indigo-500/20 text-indigo-300 border-indigo-400/30",paid:"bg-emerald-500/20 text-emerald-300 border-emerald-400/30",onhold:"bg-amber-500/20 text-amber-300 border-amber-400/30"}[t]),children:t})}function p(e){return"number"!=typeof e?"—":e.toLocaleString("fr-FR",{style:"currency",currency:"EUR",maximumFractionDigits:0})}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=166)}),_N_E=e.O()}]);